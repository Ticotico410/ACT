<mujoco model="xarm6_gripper">
  <compiler angle="radian" autolimits="true" meshdir="assets"/>

  <option timestep="0.002" iterations="50" tolerance="1e-10" gravity="0.0 0.0 -9.81">
  </option>

  <asset>
    <material name="Black" rgba="0.0 0.0 0.0 1.0"/>
    <material name="gray" rgba="0.753 0.753 0.753 1"/>
    <material name="Red" rgba="0.85 0.19  0.21 1.0"/>
    <material name="Blue" rgba="0.28 0.52 0.92 1.0"/>
    <material name="Green" rgba="0.23 0.72 0.32 1.0"/>
    <material name="Yellow" rgba="0.95 0.76 0.05 1.0"/>
    <material name="White" rgba="1.0 1.0 1.0 1.0"/>
    <material name="Silver" rgba="0.753 0.753 0.753 1.0"/>

    <!-- Arm meshes -->
    <mesh file="base_link.STL"/>
    <mesh file="base.stl"/>
    <mesh file="link1.stl"/>
    <mesh file="link2.stl"/>
    <mesh file="link3.stl"/>
    <mesh file="link4.stl"/>
    <mesh file="link5.stl"/>
    <mesh file="link6.stl"/>
    
    <!-- Gripper meshes (relative to meshdir, need to go up one level) -->
    <mesh name="gripper_base_mesh" file="../xarm_gripper/meshes/base_link.STL" scale="1 1 1"/>
    <mesh name="left_outer_knuckle_mesh" file="../xarm_gripper/meshes/left_outer_knuckle.STL" scale="1 1 1"/>
    <mesh name="left_finger_mesh" file="../xarm_gripper/meshes/left_finger.STL" scale="1 1 1"/>
    <mesh name="left_inner_knuckle_mesh" file="../xarm_gripper/meshes/left_inner_knuckle.STL" scale="1 1 1"/>
    <mesh name="right_outer_knuckle_mesh" file="../xarm_gripper/meshes/right_outer_knuckle.STL" scale="1 1 1"/>
    <mesh name="right_finger_mesh" file="../xarm_gripper/meshes/right_finger.STL" scale="1 1 1"/>
    <mesh name="right_inner_knuckle_mesh" file="../xarm_gripper/meshes/right_inner_knuckle.STL" scale="1 1 1"/>
  </asset>

  <default>
    <default class="xarm6">
      <geom type="mesh" material="White"/>
      <joint axis="0 0 1" armature="0.1" range="-6.28319 6.28319" frictionloss="1"/>
      <general biastype="affine" ctrlrange="-6.28319 6.28319"/>
      <default class="size1">
        <joint damping="10"/>
        <general gainprm="1500" biasprm="0 -1500 -150" forcerange="-50 50"/>
      </default>
      <default class="size2">
        <joint damping="5"/>
        <general gainprm="1000" biasprm="0 -1000 -100" forcerange="-32 32"/>
      </default>
      <default class="size3">
        <joint damping="2"/>
        <general gainprm="800" biasprm="0 -800 -80" forcerange="-20 20"/>
      </default>
      <default class="visual">
        <geom type="mesh" contype="0" conaffinity="0" rgba="0.7 0.7 0.7 1" group="0"/>
      </default>
      <default class="collision">
        <geom contype="1" conaffinity="1" friction="1 0.005 0.0001" density="2000" group="3" rgba="0.2 0.2 1 0.3"/>
      </default>
    </default>
    <site size="0.001" rgba="1 0 0 1" group="4"/>
  </default>

  <worldbody>
    <body name="link_base" pos="0 0 0.0005584923398936209" quat="1 0 0 0">
      <!-- <inertial pos="0 0 0" 
                     quat="1 0 0 0" mass="2.7" 
                     diaginertia="0.00494875 0.00494174 0.002219"/> -->
      <geom class="visual" mesh="base"/>
      <geom class="collision" type="box" pos="0 0 0.06" size="0.06 0.06 0.06" contype="0" conaffinity="0"/>

      <body name="link1" pos="0 0 0.267">
        <inertial pos="-0.002 0.02692 -0.01332" 
                  quat="0.983139 0.180751 -0.00455228 0.0272976" 
                  mass="2.16" 
                  diaginertia="0.00539487 0.00519906 0.00281397" />
        <joint name="joint1" class="size1"/>
        <geom class="visual" mesh="link1"/>
        <geom class="collision" type="capsule" fromto="0 0 -0.10  0 0 -0.01"  size="0.06"/>

        <body name="link2" quat="0.707105 -0.707108 0 0">
          <inertial pos="0.03531 -0.21398 0.03386" 
                    quat="0.361402 0.186059 -0.606177 0.683608" 
                    mass="1.71" 
                    diaginertia="0.0274285 0.0243228 0.0031487" />
          <joint name="joint2" class="size1" range="-2.059 2.0944"/>
          <geom class="visual" mesh="link2"/>
          <geom class="collision" type="capsule" fromto="0.04 -0.28 0 0 -0.12 0" size="0.06"/>

          <body name="link3" pos="0.0535 -0.2845 0">
            <inertial pos="0.06781 0.10749 0.01457" 
                      quat="0.263428 0.373979 -0.79161 0.405092" 
                      mass="1.384" 
                      diaginertia="0.0066317 0.00482342 0.00214488" />
            <joint name="joint3" class="size2" range="-3.927 0.19198"/>
            <geom class="visual" mesh="link3"/>
            <geom class="collision" type="capsule" fromto="0.08 0.11 0.06    0.08 0.11 -0.005" size="0.06"/>
            
            <body name="link4" pos="0.0775 0.3425 0" quat="0.707105 -0.707108 0 0">
              <inertial pos="-0.00021 0.02578 -0.02538" 
                        quat="0.994019 0.0752563 -0.00686804 0.0788347" 
                        mass="1.115" 
                        diaginertia="0.00440091 0.00406855 0.00103407" />
              <joint name="joint4" class="size2"/>
              <geom class="visual" mesh="link4"/>
              <geom class="collision" type="box" pos="0 0.05 -0.07" size="0.04 0.03 0.1"/>

              <body name="link5" quat="0.707105 0.707108 0 0">
                <inertial pos="0.05428 0.01781 0.00543" 
                          quat="-0.0766302 0.578118 -0.269638 0.766291" 
                          mass="1.375" 
                          diaginertia="0.00289757 0.0023276 0.000951789" />
                <joint name="joint5" class="size2" range="-1.69297 3.14159"/>
                <geom class="visual" mesh="link5"/>
                <geom class="collision" type="capsule" fromto="0 0.01 0.021 0.08 0.01 0.01" size="0.03"/>

                <body name="link6" pos="0.076 0.097 0" quat="0.707105 -0.707108 0 0">
                  <inertial pos="0 0.00064 -0.00952" 
                            quat="0 0.707107 0 0.707107" 
                            mass="0.1096" 
                            diaginertia="7.9715e-05 4.8111e-05 4.5293e-05" />
                  <joint name="joint6" class="size3" range="-6.28318530718 6.28318530718"/>
                  <geom class="visual" mesh="link6"/>
                  <geom class="collision" type="capsule" fromto="0 0 -0.042 0 0 -0.022" size="0.04"/>

                  <!-- Gripper base (fixed to link6) -->
                  <body name="xarm_gripper_base_link" pos="0 0 0" quat="1 0 0 0">
                    <inertial pos="-0.00065489 -0.0018497 0.048028" 
                              quat="1 0 0 0" 
                              mass="0.54156" 
                              diaginertia="0.00047106 0.00033072 0.00025642"/>
                    <geom type="mesh" mesh="gripper_base_mesh" material="White" contype="0" conaffinity="0" group="0"/>
                    <geom class="collision" type="box" pos="0 0 0.025" size="0.03 0.03 0.05" contype="0" conaffinity="0"/>

                    <!-- Left outer knuckle (driven by drive_joint) -->
                    <body name="left_outer_knuckle" pos="0 0.035 0.059098">
                      <inertial pos="2.9948E-14 0.021559 0.015181" 
                                quat="1 0 0 0" 
                                mass="0.033618" 
                                diaginertia="1.9111E-05 6.6256E-06 1.3185E-05"/>
                      <joint name="drive_joint" type="hinge" axis="1 0 0" range="0 0.85" damping="1" frictionloss="0.0"/>
                      <geom type="mesh" mesh="left_outer_knuckle_mesh" material="Silver" contype="0" conaffinity="0" group="0"/>
                      <geom class="collision" type="box" pos="0 0.01 0.01" size="0.01 0.02 0.02" contype="0" conaffinity="0"/>
                      
                      <!-- Left finger (mimics drive_joint) -->
                      <body name="left_finger" pos="0 0.035465 0.042039">
                        <inertial pos="-2.4536E-14 -0.016413 0.029258" 
                                  quat="1 0 0 0" 
                                  mass="0.048304" 
                                  diaginertia="1.7493E-05 1.7225E-05 5.1466E-06"/>
                        <joint name="left_finger_joint" type="hinge" axis="-1 0 0" range="0 0.85" damping="1" frictionloss="0.0"/>
                        <geom type="mesh" mesh="left_finger_mesh" material="Silver" contype="0" conaffinity="0" group="0"/>
                        <geom class="collision" type="box" pos="0 0 0.02" size="0.005 0.01 0.03" contype="0" conaffinity="0"/>
                      </body>
                    </body>

                    <!-- Left inner knuckle (mimics drive_joint) -->
                    <body name="left_inner_knuckle" pos="0 0.02 0.074098">
                      <inertial pos="1.86600784687907E-06 0.0220467847633621 0.0261334672830885" 
                                quat="1 0 0 0" 
                                mass="0.0230125781256706" 
                                diaginertia="6.09490024271906E-06 6.01955084375188E-06 5.07862004479903E-06"/>
                      <joint name="left_inner_knuckle_joint" type="hinge" axis="1 0 0" range="0 0.85" damping="1" frictionloss="0.0"/>
                      <geom type="mesh" mesh="left_inner_knuckle_mesh" material="Silver" contype="0" conaffinity="0" group="0"/>
                      <geom class="collision" type="box" pos="0 0.01 0.01" size="0.008 0.015 0.015" contype="0" conaffinity="0"/>
                    </body>

                    <!-- Right outer knuckle (mimics drive_joint, opposite direction) -->
                    <body name="right_outer_knuckle" pos="0 -0.035 0.059098">
                      <inertial pos="-3.1669E-14 -0.021559 0.015181" 
                                quat="1 0 0 0" 
                                mass="0.033618" 
                                diaginertia="1.9111E-05 6.6256E-06 1.3185E-05"/>
                      <joint name="right_outer_knuckle_joint" type="hinge" axis="-1 0 0" range="0 0.85" damping="1" frictionloss="0.0"/>
                      <geom type="mesh" mesh="right_outer_knuckle_mesh" material="Silver" contype="0" conaffinity="0" group="0"/>
                      <geom class="collision" type="box" pos="0 -0.01 0.01" size="0.01 0.02 0.02" contype="0" conaffinity="0"/>
                      
                      <!-- Right finger (mimics drive_joint) -->
                      <body name="right_finger" pos="0 -0.035465 0.042039">
                        <inertial pos="2.5618E-14 0.016413 0.029258" 
                                  quat="1 0 0 0" 
                                  mass="0.048304" 
                                  diaginertia="1.7493E-05 1.7225E-05 5.1466E-06"/>
                        <joint name="right_finger_joint" type="hinge" axis="1 0 0" range="0 0.85" damping="1" frictionloss="0.0"/>
                        <geom type="mesh" mesh="right_finger_mesh" material="Silver" contype="0" conaffinity="0" group="0"/>
                        <geom class="collision" type="box" pos="0 0 0.02" size="0.005 0.01 0.03" contype="0" conaffinity="0"/>
                      </body>
                    </body>

                    <!-- Right inner knuckle (mimics drive_joint, opposite direction) -->
                    <body name="right_inner_knuckle" pos="0 -0.02 0.074098">
                      <inertial pos="1.866E-06 -0.022047 0.026133" 
                                quat="1 0 0 0" 
                                mass="0.023013" 
                                diaginertia="6.0949E-06 6.0197E-06 5.0784E-06"/>
                      <joint name="right_inner_knuckle_joint" type="hinge" axis="-1 0 0" range="0 0.85" damping="1" frictionloss="0.0"/>
                      <geom type="mesh" mesh="right_inner_knuckle_mesh" material="Silver" contype="0" conaffinity="0" group="0"/>
                      <geom class="collision" type="box" pos="0 -0.01 0.01" size="0.008 0.015 0.015" contype="0" conaffinity="0"/>
                    </body>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <!-- Equality constraints to implement mimic behavior: all joints follow drive_joint -->
  <equality>
    <joint joint1="drive_joint" joint2="left_finger_joint"         polycoef="0 1 0 0 0" solref="0.002 1" solimp="0.98 0.99 0.001"/>
    <joint joint1="drive_joint" joint2="left_inner_knuckle_joint"  polycoef="0 1 0 0 0" solref="0.002 1" solimp="0.98 0.99 0.001"/>
    <joint joint1="drive_joint" joint2="right_outer_knuckle_joint" polycoef="0 1 0 0 0" solref="0.002 1" solimp="0.98 0.99 0.001"/>
    <joint joint1="drive_joint" joint2="right_finger_joint"        polycoef="0 1 0 0 0" solref="0.002 1" solimp="0.98 0.99 0.001"/>
    <joint joint1="drive_joint" joint2="right_inner_knuckle_joint" polycoef="0 1 0 0 0" solref="0.002 1" solimp="0.98 0.99 0.001"/>
  </equality>
  <!-- Position Motor Actuators -->
  <actuator>
    <position name="act1" joint="joint1" class="size1"  group="1" kp="350"/>
    <position name="act2" joint="joint2" class="size1" ctrlrange="-2.059 2.0944" group="1" kp="350"/>
    <position name="act3" joint="joint3" class="size2" ctrlrange="-3.927 0.19198" group="1" kp="350"/>
    <position name="act4" joint="joint4" class="size2" group="1" kp="350"/>
    <position name="act5" joint="joint5" class="size2" ctrlrange="-1.69297 3.14159" group="1" kp="350"/>
    <position name="act6" joint="joint6" class="size3" group="1" kp="350"/>
    <!-- Gripper drive joint actuator (only need to control this one, others follow via equality) -->
    <position name="act_gripper" joint="drive_joint" ctrlrange="0 0.85" kp="200" forcelimited="true" forcerange="-50 50"/>
  </actuator>

  <keyframe>
    <key qpos="0.0 -0.78 -0.78 0.0 1.5708 0.0  0.85 0.85 0.85 0.85 0.85 0.85"/>
  </keyframe>

</mujoco>

